# –°–∏—Å—Ç–µ–º–∞ –≤–µ—Ç–≤–ª–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ Nexus Editor

## üåø –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –≤–µ—Ç–≤–ª–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø—É—Ç—è–º–∏ —Ä–∞–∑–≤–∏—Ç–∏—è, –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –Ω–∞–≤—ã–∫–æ–≤ –∏ —É—Å–ª–æ–≤–Ω—ã–º–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏ –≤ —Å—Ç–∏–ª–µ Disco Elysium.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Backend (Django)

#### –ú–æ–¥–µ–ª–∏
- **Post** - –ü–æ—Å—Ç—ã –¥–∏–∞–ª–æ–≥–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤–µ—Ç–≤–ª–µ–Ω–∏—è
- **DialogueOption** - –û–ø—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤ —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ skill checks
- **Dialogue** - –î–∏–∞–ª–æ–≥–∏ —Å –ø–æ–¥—Å—á–µ—Ç–æ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤–µ—Ç–≤–ª–µ–Ω–∏—è

#### –ù–æ–≤—ã–µ –ø–æ–ª—è Post
```python
has_options = models.BooleanField(default=False)
is_branching_point = models.BooleanField(default=False)
post_type = models.CharField(choices=[...])  # statement, question, action, narration
color = models.CharField(max_length=7, default="#6B7280")
icon = models.CharField(max_length=50, default="üí¨")
```

#### –ù–æ–≤—ã–µ –ø–æ–ª—è DialogueOption
```python
option_type = models.CharField(choices=[...])  # response, choice, skill_check, condition
next_dialogue = models.ForeignKey(Dialogue, ...)  # –°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º –¥–∏–∞–ª–æ–≥–æ–º
next_post = models.ForeignKey(Post, ...)  # –°–≤—è–∑—å —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –ø–æ—Å—Ç–æ–º
required_skill = models.CharField(max_length=30)
required_skill_value = models.IntegerField()
condition_text = models.TextField()
condition_met = models.BooleanField(default=True)
color = models.CharField(max_length=7, default="#3B82F6")
icon = models.CharField(max_length=50, default="üí¨")
metadata = models.JSONField(default=dict)
```

### Frontend (React + TypeScript)

#### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **DialogueNodeEditor** - –†–µ–¥–∞–∫—Ç–æ—Ä —É–∑–ª–æ–≤ –¥–∏–∞–ª–æ–≥–∞ —Å –æ–ø—Ü–∏—è–º–∏
- **Canvas** - –í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤–µ—Ç–≤–ª–µ–Ω–∏—è
- **Editor** - –ì–ª–∞–≤–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

#### –¢–∏–ø—ã
```typescript
interface Post {
  has_options: boolean;
  is_branching_point: boolean;
  post_type: 'statement' | 'question' | 'action' | 'narration';
  color: string;
  icon: string;
  available_options?: DialogueOption[];
}

interface DialogueOption {
  option_type: 'response' | 'choice' | 'skill_check' | 'condition';
  next_dialogue?: UUID;
  next_post?: UUID;
  required_skill?: string;
  required_skill_value?: number;
  condition_text?: string;
  condition_met: boolean;
  color: string;
  icon: string;
  metadata?: Record<string, any>;
  is_accessible?: boolean;
}
```

## üöÄ API Endpoints

### –ù–æ–≤—ã–µ endpoints
- `GET /api/dialogues/{id}/tree/` - –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ä–µ–≤–æ –¥–∏–∞–ª–æ–≥–∞
- `POST /api/dialogues/branch/` - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ç–∫—É
- `POST /api/dialogues/option/` - –°–æ–∑–¥–∞—Ç—å –æ–ø—Ü–∏—é –¥–∏–∞–ª–æ–≥–∞

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ –¥–∏–∞–ª–æ–≥–∞
```javascript
const response = await getDialogueTree(dialogueId, characterId);
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: { dialogue: Dialogue, tree_structure: DialogueTree }
```

#### –°–æ–∑–¥–∞–Ω–∏–µ –æ–ø—Ü–∏–∏
```javascript
const option = await createDialogueOption({
  dialogue_id: "uuid",
  text: "–ü–æ–ø—ã—Ç–∞—Ç—å—Å—è —É–±–µ–¥–∏—Ç—å",
  option_type: "skill_check",
  post_id: "uuid",
  color: "#10B981",
  icon: "üé≤"
});
```

#### –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ç–∫–∏
```javascript
const branch = await createDialogueBranch({
  parent_dialogue_id: "uuid",
  option_id: "uuid", 
  title: "–£—Å–ø–µ—à–Ω–æ–µ —É–±–µ–∂–¥–µ–Ω–∏–µ"
});
```

## üé® UI/UX

### –í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
- **–¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ö–∞–∂–¥—ã–π —Ç–∏–ø –æ–ø—Ü–∏–∏ –∏–º–µ–µ—Ç —Å–≤–æ–π —Ü–≤–µ—Ç
- **–ò–∫–æ–Ω–∫–∏** - –í–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Ç–∏–ø–æ–≤ –ø–æ—Å—Ç–æ–≤ –∏ –æ–ø—Ü–∏–π
- **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏** - –ü–ª–∞–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –≤ —Å—Ç–∏–ª–µ Notus React
- **–í–µ—Ç–≤–ª–µ–Ω–∏–µ** - –í–∏–∑—É–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏

### –¢–∏–ø—ã —É–∑–ª–æ–≤ –≤ Canvas
- **Post Node** - –ü–æ—Å—Ç—ã –¥–∏–∞–ª–æ–≥–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≤–µ—Ç–≤–ª–µ–Ω–∏–∏
- **Option Node** - –û–ø—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤ —Å —Ü–≤–µ—Ç–æ–≤—ã–º –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- **Branch Node** - –¢–æ—á–∫–∏ –≤–µ—Ç–≤–ª–µ–Ω–∏—è –∫ –¥—Ä—É–≥–∏–º –¥–∏–∞–ª–æ–≥–∞–º
- **Character Node** - –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–∏–ø)

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞ —Å –≤–µ—Ç–≤–ª–µ–Ω–∏–µ–º

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Dialogue Nodes** –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
2. –í—ã–±–µ—Ä–∏—Ç–µ –¥–∏–∞–ª–æ–≥ –∏–∑ —Å–ø–∏—Å–∫–∞
3. –î–æ–±–∞–≤—å—Ç–µ –ø–æ—Å—Ç—ã —Å –ø–æ–º–æ—â—å—é **+ Add Post**
4. –î–ª—è –ø–æ—Å—Ç–æ–≤ —Å –æ–ø—Ü–∏—è–º–∏ –Ω–∞–∂–º–∏—Ç–µ **+ Add Option**
5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç–∏–ø –æ–ø—Ü–∏–∏, —Ü–≤–µ—Ç –∏ –∏–∫–æ–Ω–∫—É

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ç–æ–∫

1. –°–æ–∑–¥–∞–π—Ç–µ –æ–ø—Ü–∏—é –¥–∏–∞–ª–æ–≥–∞
2. –ù–∞–∂–º–∏—Ç–µ **üåø Add Branch**
3. –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≤–µ—Ç–∫–∏
4. –í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –≤–µ–¥–µ—Ç –∫ –≤–µ—Ç–∫–µ

### 3. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤ Canvas

1. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Canvas**
2. –í—ã–±–µ—Ä–∏—Ç–µ –¥–∏–∞–ª–æ–≥ –∏–∑ —Å–∞–π–¥–±–∞—Ä–∞
3. –£–≤–∏–¥–∏—Ç–µ –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –¥–µ—Ä–µ–≤–æ —Å —É–∑–ª–∞–º–∏ –∏ —Å–≤—è–∑—è–º–∏
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Dialogue Nodes** –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üéØ –¢–∏–ø—ã –æ–ø—Ü–∏–π

### Response (–û—Ç–≤–µ—Ç)
- –û–±—ã—á–Ω—ã–π –æ—Ç–≤–µ—Ç –∏–≥—Ä–æ–∫–∞
- –¶–≤–µ—Ç: `#3B82F6` (—Å–∏–Ω–∏–π)
- –ò–∫–æ–Ω–∫–∞: `üí¨`

### Choice (–í—ã–±–æ—Ä)
- –í—ã–±–æ—Ä –¥–µ–π—Å—Ç–≤–∏—è
- –¶–≤–µ—Ç: `#10B981` (–∑–µ–ª–µ–Ω—ã–π)  
- –ò–∫–æ–Ω–∫–∞: `üéØ`

### Skill Check (–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–≤—ã–∫–∞)
- –¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–≤—ã–∫–∞
- –¶–≤–µ—Ç: `#F59E0B` (–æ—Ä–∞–Ω–∂–µ–≤—ã–π)
- –ò–∫–æ–Ω–∫–∞: `üé≤`

### Condition (–£—Å–ª–æ–≤–∏–µ)
- –£—Å–ª–æ–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥
- –¶–≤–µ—Ç: `#8B5CF6` (—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π)
- –ò–∫–æ–Ω–∫–∞: `üîó`

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–ø—Ü–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ:
- `is_available` - –û–±—â–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–ø—Ü–∏–∏
- `condition_met` - –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π
- `required_skill` + `required_skill_value` - –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –Ω–∞–≤—ã–∫–∞–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–î–∏–∞–ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø—Ü–∏–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫ –≤–µ—Ç–≤–ª–µ–Ω–∏—è

## üöÄ –ó–∞–ø—É—Å–∫

### Backend
```bash
cd backend
python3 manage.py runserver
```

### Frontend  
```bash
cd frontend
npm run dev
```

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä —É—Å–ª–æ–≤–∏–π
- [ ] –ò–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç –¥–µ—Ä–µ–≤—å–µ–≤ –¥–∏–∞–ª–æ–≥–æ–≤
- [ ] –°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤
- [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤
- [ ] –®–∞–±–ª–æ–Ω—ã –¥–∏–∞–ª–æ–≥–æ–≤
- [ ] –ö–æ–ª–ª–∞–±–æ—Ä–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## üìù –ü—Ä–∏–º–µ—Ä—ã

### –ü—Ä–æ—Å—Ç–æ–π –¥–∏–∞–ª–æ–≥ —Å –≤–µ—Ç–≤–ª–µ–Ω–∏–µ–º
```
NPC: "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?"
‚îú‚îÄ –ò–≥—Ä–æ–∫: "–û—Ç–ª–∏—á–Ω–æ!" ‚Üí –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞
‚îú‚îÄ –ò–≥—Ä–æ–∫: "–ü–ª–æ—Ö–æ..." ‚Üí –í–µ—Ç–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏  
‚îî‚îÄ –ò–≥—Ä–æ–∫: "–ù–µ —Ç–≤–æ–µ –¥–µ–ª–æ!" ‚Üí –í–µ—Ç–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞
```

### –î–∏–∞–ª–æ–≥ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞–≤—ã–∫–∞
```
NPC: "–ú–æ–∂–µ—à—å –ø–æ–º–æ—á—å –º–Ω–µ —Å —ç—Ç–æ–π –∑–∞–¥–∞—á–µ–π?"
‚îú‚îÄ –ò–≥—Ä–æ–∫: "–ö–æ–Ω–µ—á–Ω–æ!" (Logic 4+) ‚Üí –£—Å–ø–µ—à–Ω–∞—è –ø–æ–º–æ—â—å
‚îú‚îÄ –ò–≥—Ä–æ–∫: "–ü–æ–ø—Ä–æ–±—É—é..." (Logic 2+) ‚Üí –ß–∞—Å—Ç–∏—á–Ω—ã–π —É—Å–ø–µ—Ö
‚îî‚îÄ –ò–≥—Ä–æ–∫: "–ù–µ —É–≤–µ—Ä–µ–Ω..." ‚Üí –û—Ç–∫–∞–∑
```

–°–∏—Å—Ç–µ–º–∞ –≤–µ—Ç–≤–ª–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ
